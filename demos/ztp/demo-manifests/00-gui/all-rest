apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  name: edge-operators
  namespace: demo-ztp-gui-1
  annotations:
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/standards: NIST SP 800-53
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
spec:
  disabled: false
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1beta1
        kind: OperatorPolicy
        metadata:
          name: install-operator
        spec:
          remediationAction: enforce
          severity: critical
          complianceType: musthave
          subscription:
            name: kubevirt-hyperconverged
            namespace: openshift-cnv
            channel: stable
            source: redhat-operators
            sourceNamespace: openshift-marketplace
            startingCSV: kubevirt-hyperconverged-operator.v4.16.0
          upgradeApproval: Automatic
          versions:
---
apiVersion: cluster.open-cluster-management.io/v1beta1
kind: Placement
metadata:
  name: edge-gui-placement
  namespace: demo-ztp-gui-1
spec:
  tolerations:
    - key: cluster.open-cluster-management.io/unreachable
      operator: Exists
    - key: cluster.open-cluster-management.io/unavailable
      operator: Exists
  clusterSets:
    - edge
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: edge-gui-placement
  namespace: demo-ztp-gui-1
placementRef:
  name: edge-gui-placement
  apiGroup: cluster.open-cluster-management.io
  kind: Placement
subjects:
  - name: edge-gui
    apiGroup: policy.open-cluster-management.io
    kind: Policy























apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  name: edge-app-hello
  namespace: demo-ztp-gui-1
spec:
  remediationAction: enforce
  disabled: false
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: hello-world-namespace-policy
        spec:
          remediationAction: enforce
          severity: high
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: v1
                kind: Namespace
                metadata:
                  name: hello-world
                  annotations:
                    argocd.argoproj.io/sync-wave: "0"
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: hello-world-deployment-policy
        spec:
          remediationAction: enforce
          severity: high
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: apps/v1
                kind: Deployment
                metadata:
                  name: hello-world
                  namespace: hello-world
                  labels:
                    application: hello-world
                spec:
                  replicas: 1
                  revisionHistoryLimit: 3
                  selector:
                    matchLabels:
                      deploymentconfig: hello-world
                  template:
                    metadata:
                      name: hello-world
                      labels:
                        app: hello-world
                        deploymentconfig: hello-world
                    spec:
                      containers:
                        - name: apache
                          image: registry.access.redhat.com/ubi8/httpd-24:1-226
                          ports:
                            - name: http
                              containerPort: 8080
                              protocol: TCP
                          volumeMounts:
                            - name: hello-world-configmap
                              mountPath: /var/www/html
                          livenessProbe:
                            httpGet:
                              path: /index.html
                              port: 8080
                              scheme: HTTP
                            initialDelaySeconds: 5
                            timeoutSeconds: 1
                            periodSeconds: 10
                            successThreshold: 1
                            failureThreshold: 3
                          readinessProbe:
                            httpGet:
                              path: /index.html
                              port: 8080
                              scheme: HTTP
                            initialDelaySeconds: 5
                            timeoutSeconds: 1
                            periodSeconds: 10
                            successThreshold: 1
                            failureThreshold: 3
                      volumes:
                        - name: hello-world-configmap
                          configMap:
                            name: hello-world-configmap
                            defaultMode: 438
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: hello-world-configmap-policy
        spec:
          remediationAction: enforce
          severity: high
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: v1
                kind: ConfigMap
                metadata:
                  name: hello-world-configmap
                  namespace: hello-world
                  labels:
                    app.kubernetes.io/instance: hello-world
                data:
                  index.html: |-
                    <!DOCTYPE html>
                      <html lang="en">
                        <head>
                          <meta charset="utf-8">
                          <title>Hello World</title>
                        </head>
                          <body>
                            <h1>Hello!</h1>
                            <br/>
                            <h2>
                            I'm running at the Edge!<br>
                            </h2>
                          </body>
                      </html>
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: hello-world-service-policy
        spec:
          remediationAction: enforce
          severity: high
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: v1
                kind: Service
                metadata:
                  name: hello-world
                  namespace: hello-world
                  labels:
                    app: hello-world
                spec:
                  ports:
                    - name: 8080-tcp
                      port: 8080
                      protocol: TCP
                      targetPort: 8080
                  selector:
                    app: hello-world
                    deploymentconfig: hello-world
                  sessionAffinity: None
                  type: ClusterIP
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: hello-world-route-policy
        spec:
          remediationAction: enforce
          severity: high
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: route.openshift.io/v1
                kind: Route
                metadata:
                  name: hello-world
                  namespace: hello-world
                  labels:
                    app: hello-world
                spec:
                  port:
                    targetPort: 8080-tcp
                  to:
                    name: hello-world
                    kind: Service
                    weight: 100
                  wildcardPolicy: None
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: edge-app-hello-placement
  namespace: demo-ztp-gui-1
placementRef:
  name: edge-gui-placement
  apiGroup: cluster.open-cluster-management.io
  kind: Placement
subjects:
  - name: edge-app-hello
    apiGroup: policy.open-cluster-management.io
    kind: Policy

















apiVersion: policy.open-cluster-management.io/v1beta1
kind: PolicySet
metadata:
  name: edge
  namespace: demo-ztp-gui-1
spec:
  description: ""
  policies:
    - edge-operators
    - edge-app-hello
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: edge-placement
  namespace: demo-ztp-gui-1
placementRef:
  name: edge-gui-placement
  apiGroup: cluster.open-cluster-management.io
  kind: Placement
subjects:
  - name: edge
    apiGroup: policy.open-cluster-management.io
    kind: PolicySet
